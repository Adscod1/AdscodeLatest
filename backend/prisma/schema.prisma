generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id            String         @id @default(uuid())
  email         String         @unique
  name          String?
  emailVerified Boolean        @default(false)
  image         String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  posts         Post[]
  StoreReview   StoreReview[]
  accounts      Account[]
  Influencer    Influencer?
  sessions      Session[]
  Store         Store[]
  notifications Notification[]
  comments      Comment[]

  @@map("user")
}

model Post {
  id        Int     @id @default(autoincrement())
  title     String
  content   String?
  published Boolean @default(false)
  authorId  String
  author    User    @relation(fields: [authorId], references: [id])

  @@index([authorId], map: "Post_authorId_fkey")
}

model Session {
  id        String   @id @default(uuid())
  expiresAt DateTime
  token     String   @unique
  createdAt DateTime
  updatedAt DateTime
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "session_userId_fkey")
  @@map("session")
}

model Account {
  id                    String    @id @default(uuid())
  accountId             String
  providerId            String
  userId                String
  accessToken           String?   @db.Text
  refreshToken          String?   @db.Text
  idToken               String?   @db.Text
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime
  updatedAt             DateTime
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "account_userId_fkey")
  @@map("account")
}

model Verification {
  id         String    @id @default(uuid())
  identifier String
  value      String    @db.Text
  expiresAt  DateTime
  createdAt  DateTime?
  updatedAt  DateTime?

  @@map("verification")
}

model Profile {
  id        String   @id @default(uuid())
  userId    String   @unique
  name      String?
  image     String?
  location  String?
  role      Role     @default(USER)
  bio       String?
  website   String?
  socials   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("profile")
}

model Store {
  id              String           @id @default(uuid())
  name            String
  tagline         String?
  description     String?          @db.Text
  category        String?
  regNumber       String?
  yearEstablished Int?
  phone           String?
  email           String?
  address         String?
  city            String?
  state           String?
  country         String?
  zip             String?
  website         String?
  logo            String?
  banner          String?
  userId          String
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  StoreReview     StoreReview[]
  Product         Product[]
  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  StoreActivity   StoreActivity[]
  StoreHours      StoreHours[]
  StoreImage      StoreImage[]
  StoreSocial     StoreSocial[]
  StoreVideo      StoreVideo[]
  StoreHighlight  StoreHighlight[]
  campaigns       Campaign[]

  @@index([userId], map: "store_userId_fkey")
  @@map("store")
}

model StoreSocial {
  id      String @id @default(uuid())
  storeId String
  social  String
  store   Store  @relation(fields: [storeId], references: [id])

  @@index([storeId], map: "store_social_storeId_fkey")
  @@map("store_social")
}

model StoreHours {
  id      String @id @default(uuid())
  storeId String
  day     String
  open    String
  close   String
  store   Store  @relation(fields: [storeId], references: [id])

  @@index([storeId], map: "store_hours_storeId_fkey")
  @@map("store_hours")
}

model StoreImage {
  id      String @id @default(uuid())
  storeId String
  image   String
  store   Store  @relation(fields: [storeId], references: [id])

  @@index([storeId], map: "store_image_storeId_fkey")
  @@map("store_image")
}

model StoreVideo {
  id      String @id @default(uuid())
  storeId String
  video   String
  store   Store  @relation(fields: [storeId], references: [id])

  @@index([storeId], map: "store_video_storeId_fkey")
  @@map("store_video")
}

model StoreHighlight {
  id        String @id @default(uuid())
  storeId   String
  highlight String
  store     Store  @relation(fields: [storeId], references: [id])

  @@index([storeId], map: "store_highlight_storeId_fkey")
  @@map("store_highlight")
}

model Product {
  id                   String             @id @default(uuid())
  title                String
  description          String?            @db.Text
  category             String?
  vendor               String?
  tags                 String?
  price                Float
  comparePrice         Float?
  costPerItem          Float?
  weight               Float?
  weightUnit           String?
  length               Float?
  width                Float?
  height               Float?
  sizeUnit             String?
  countryOfOrigin      String?
  harmonizedSystemCode String?
  status               String             @default("DRAFT")
  storeId              String
  views                Int                @default(0)
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  store                Store              @relation(fields: [storeId], references: [id])
  images               ProductImage[]
  variations           ProductVariation[]
  videos               ProductVideo[]
  comments             Comment[]

  @@index([storeId], map: "product_storeId_fkey")
  @@map("product")
}

model ProductVariation {
  id        String  @id @default(uuid())
  name      String
  value     String
  price     Float
  stock     Int
  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId], map: "product_variation_productId_fkey")
  @@map("product_variation")
}

model ProductImage {
  id        String  @id @default(uuid())
  url       String
  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId], map: "product_image_productId_fkey")
  @@map("product_image")
}

model ProductVideo {
  id        String  @id @default(uuid())
  url       String
  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId], map: "product_video_productId_fkey")
  @@map("product_video")
}

model Comment {
  id        String   @id @default(uuid())
  content   String   @db.Text
  userId    String
  productId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([userId], map: "comment_userId_fkey")
  @@index([productId], map: "comment_productId_fkey")
  @@map("comment")
}

model StoreActivity {
  id        String            @id @default(uuid())
  storeId   String
  activity  StoreActivityType
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
  productId String?
  store     Store             @relation(fields: [storeId], references: [id])

  @@index([storeId], map: "store_activity_storeId_fkey")
  @@map("store_activity")
}

model StoreReview {
  id        String   @id @default(uuid())
  userId    String
  storeId   String
  rating    Int
  comment   String?
  images    String?  @db.Text // JSON array of image URLs
  videos    String?  @db.Text // JSON array of video URLs
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  store     Store    @relation(fields: [storeId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@index([storeId], map: "StoreReview_storeId_fkey")
  @@index([userId], map: "StoreReview_userId_fkey")
}

model Influencer {
  id                   String               @id @default(uuid())
  userId               String               @unique
  firstName            String
  lastName             String
  phone                String?
  country              String?
  city                 String?
  primaryNiche         String
  secondaryNiches      String?
  bio                  String?
  websiteUrl           String?
  ratePerPost          String?
  brandCollaborations  String?
  status               InfluencerStatus     @default(PENDING)
  applicationDate      DateTime             @default(now())
  approvalDate         DateTime?
  createdAt            DateTime             @default(now())
  updatedAt            DateTime             @updatedAt
  user                 User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  socialAccounts       InfluencerSocial[]
  campaignApplications CampaignInfluencer[]

  @@map("influencer")
}

model InfluencerSocial {
  id           String         @id @default(uuid())
  influencerId String
  platform     SocialPlatform
  handle       String
  followers    String?
  url          String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  influencer   Influencer     @relation(fields: [influencerId], references: [id], onDelete: Cascade)

  @@index([influencerId], map: "influencer_social_influencerId_fkey")
  @@map("influencer_social")
}

model Campaign {
  id                 String         @id @default(uuid())
  brandId            String
  title              String
  description        String?        @db.Text
  budget             Float
  currency           String         @default("UGX")
  duration           Int?
  influencerLocation Json?
  platforms          Json?
  targets            Json?
  status             CampaignStatus @default(DRAFT)
  type               CampaignType   @default(PRODUCT)
  typeSpecificData   Json?
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt

  brand      Store                @relation(fields: [brandId], references: [id], onDelete: Cascade)
  applicants CampaignInfluencer[]

  @@index([brandId])
  @@index([status])
  @@index([type])
  @@map("campaign")
}

model CampaignInfluencer {
  id                String                    @id @default(uuid())
  campaignId        String
  influencerId      String
  applicationStatus CampaignApplicationStatus @default(APPLIED)
  appliedAt         DateTime                  @default(now())
  selectedAt        DateTime?
  createdAt         DateTime                  @default(now())
  updatedAt         DateTime                  @updatedAt

  campaign   Campaign   @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  influencer Influencer @relation(fields: [influencerId], references: [id], onDelete: Cascade)

  @@unique([campaignId, influencerId])
  @@index([campaignId])
  @@index([influencerId])
  @@index([applicationStatus])
  @@map("campaign_influencer")
}

model Notification {
  id        String           @id @default(uuid())
  userId    String
  type      NotificationType
  message   String           @db.Text
  link      String?
  read      Boolean          @default(false)
  createdAt DateTime         @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([read])
  @@map("notification")
}

enum Role {
  ADMIN
  USER
  INFLUENCER
}

enum StoreActivityType {
  POST
  PRODUCT
  ORDER
  REVIEW
  COMMENT
  DELETE
  UPDATE
}

enum SocialPlatform {
  INSTAGRAM
  YOUTUBE
  TIKTOK
  TWITTER
  FACEBOOK
  LINKEDIN
  TWITCH
  PINTEREST
}

enum InfluencerStatus {
  PENDING
  APPROVED
  REJECTED
  SUSPENDED
}

enum CampaignStatus {
  DRAFT
  PUBLISHED
  ACTIVE
  PAUSED
  COMPLETED
  CANCELLED
}

enum CampaignApplicationStatus {
  APPLIED
  SELECTED
  NOT_SELECTED
  WITHDRAWN
}

enum CampaignType {
  PRODUCT
  COUPON
  VIDEO
  PROFILE
}

enum NotificationType {
  CAMPAIGN_SELECTION
  APPLICATION_UPDATE
  SYSTEM
}
